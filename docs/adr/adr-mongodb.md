# [ADR.1.3] Смена PostgreSQL на MongoDB 
<!-- Название ADR состоит из [ADR.###] [Коротко суть принятого решения] -->

* Статус: Предложено
* Владелец: rgrefenshtein@mts.ru

## Контекст
<!-- Описание проблемы, требующей решения, причин, побудивших принять решение, ограничений, действовавших на момент принятия решения -->
В связи с растущими запросами бизнеса на развитие продукта поступило предложение перейти с реляционной БД на MongoDB

## Варианты решения
<!-- Описание рассмотренных вариантов c их плюсами и минусами -->

### Вариант 1. Переход на MongoDB

- \+ Динамическая схема дает гибкость в разработке
- \+ БД быстрая на запись
- \+ Полнотекстовый поиск из коробки
- \+ Быстрое развертывание БД
- \+ Простое масштабирование
- \- Одно поле может иметь разные типы данных в разных документах
- \- Определенные сложности в агрегировании данных (отсутствие JOIN)
- \- БД не удовлетворяет требованиям ACID
- \- Необходимость переписывания существующих сервисов на нов
- \- Неполная экспертиза в команде

### Вариант 2. Остаемся на PostgreSQL

- \+ БД с жесткой типизацией данных
- \+ БД быстрая на чтение
- \+ Валидация данных на уровне базы
- \+ БД удовлетворяет требованиям ACID
- \+ Доступ к данных из разных таблиц через JOIN
- \+ БД поддерживает триггеры и хранимые процедуры
- \+ Хорошая экспертиза в команде
- \- Сложное масштабирование
- \- Нетривиальное развертывание

### Вариант 3. Для новых сервисов выбираем MongoDB, для реализованных оставляем PostgreSQL

- \+ Не тратим время на переписывание реализованных сервисов
- \+ Имеем гибкость разработки новых сервисов
- \+ В новых сервисах получаем полнотекстовый поиск из коробки
- \+ Возможность подтянуть экспертизу в MongoDB
- \- Поддержка 2ух БД в проекте
- \- Новые сервисы не удовлетворяют требованиям ACID

## Решение

Предлагаем остановиться третьем варианте. Это даст нам возможность гибкой разработки при нестабильных требованиях. Мы не будем тратить время на переписывание уже реализованных сервисов, а сразу перейдем к разработке нового функционала. Это даст возможность подтянуть экспертизу в команде по MongoDB, и, как следствие, принять решение на доработку реализованных ранее сервисов использующих PostgreSQL

## Последствия
<!-- Положительные и отрицательные последствия (trade-offs). Арх. решения, которые потребуется принять как следствие принятого решения. Если решение содержит риски, то описано, как с ними планируют поступить (за счет чего снижать, почему принять). -->

Мы идем на частичный отказ от требований ACID к нашей системе, за счет добавления гибкости в разработке